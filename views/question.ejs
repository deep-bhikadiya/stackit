<%- include('header') %>

<h1><%= question.title %></h1>

<div class="question-body">
  <div><%- question.description %></div>
  <p>Asked by: <span class="username"><%= question.user %></span></p>
  <p>
    Tags:
    <% question.tags.split(',').forEach(tag => { %>
      <span class="tag"><%= tag.trim() %></span>
    <% }) %>
  </p>
</div>

<hr>

<h2>Answers</h2>

<% if (answers.length === 0) { %>
  <p>No answers yet.</p>
<% } else { %>
  <% answers.forEach(a => { %>
    <div class="answer">
      <div><%- a.content %></div>
      <p><em>Answered by <span class="username"><%= a.user %></span> on <%= new Date(a.created_at).toLocaleString() %></em></p>
    </div>
    <hr>
  <% }) %>
<% } %>

<% if (user) { %>
  <h3>Your Answer</h3>
  <form action="/question/<%= question.id %>/answer" method="POST" id="answer-form">
    <div id="editor" style="height: 200px;"></div>
    <input type="hidden" name="answer" id="answer" />
    <button type="submit" class="form-button">Post Answer</button>
  </form>
<% } else { %>
  <p><a href="/login">Log in</a> to post an answer.</p>
<% } %>

<!-- Quill + Emoji -->
<link href="https://cdn.quilljs.com/1.3.6/quill.snow.css" rel="stylesheet">
<link href="https://cdn.jsdelivr.net/npm/quill-emoji@0.1.7/dist/quill-emoji.css" rel="stylesheet">
<script src="https://cdn.quilljs.com/1.3.6/quill.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/quill-emoji@0.1.7/dist/quill-emoji.min.js"></script>

<script>
  const quill = new Quill('#editor', {
    theme: 'snow',
    modules: {
      toolbar: [
        ['bold', 'italic', 'underline', 'strike'],
        [{ 'align': [] }],
        [{ 'list': 'ordered' }, { 'list': 'bullet' }],
        ['link', 'image', 'emoji'],
        ['clean']
      ],
      "emoji-toolbar": true,
      "emoji-textarea": false,
      "emoji-shortname": true
    }
  });

  document.getElementById('answer-form')?.addEventListener('submit', function () {
    document.getElementById('answer').value = quill.root.innerHTML;
  });
</script>

<%- include('footer') %>
